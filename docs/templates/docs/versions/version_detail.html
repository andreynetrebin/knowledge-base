{% extends 'docs/base.html' %}

{% block title %}Версия v{{ version.version_number }}: {{ version.title }} - База знаний{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'docs:article_list' %}">Главная</a></li>
                <li class="breadcrumb-item"><a href="{% url 'docs:article_detail' version.article.slug %}">{{ version.article.title|truncatewords:3 }}</a></li>
                <li class="breadcrumb-item"><a href="{% url 'docs:version_list' version.article.slug %}">История версий</a></li>
                <li class="breadcrumb-item active">v{{ version.version_number }}</li>
            </ol>
        </nav>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                Версия v{{ version.version_number }}
                {% if is_current %}
                    <span class="badge bg-success fs-6">Текущая</span>
                {% endif %}
                {% if version.is_draft %}
                    <span class="badge bg-warning fs-6">Черновик</span>
                {% endif %}
            </h1>
            <div class="btn-group">
                <a href="{% url 'docs:version_list' version.article.slug %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Назад к истории
                </a>
                {% if not is_current %}
                <a href="{% url 'docs:restore_version' version.article.slug version.id %}"
                   class="btn btn-outline-success"
                   onclick="return confirm('Восстановить версию v{{ version.version_number }}? Будет создана новая версия на основе этой.')">
                    <i class="bi bi-arrow-clockwise"></i> Восстановить
                </a>
                {% endif %}
                <a href="{% url 'docs:article_detail' version.article.slug %}" class="btn btn-outline-primary">
                    <i class="bi bi-journal-text"></i> Текущая версия
                </a>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">{{ version.title }}</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Автор версии:</strong> {{ version.author.username }}<br>
                        <strong>Создана:</strong> {{ version.created_at|date:"d.m.Y H:i" }}<br>
                        <strong>Статистика:</strong> {{ version.content|wordcount }} слов
                    </div>
                    <div class="col-md-6">
                        {% if version.change_reason %}
                        <strong>Причина изменений:</strong><br>
                        <em>"{{ version.change_reason }}"</em>
                        {% endif %}
                    </div>
                </div>

                {% if version.excerpt %}
                <div class="alert alert-info">
                    <strong>Краткое описание:</strong> {{ version.excerpt }}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Содержимое версии -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Содержимое версии</h5>
            </div>
            <div class="card-body">
                <div class="article-content">
                    {{ html_content|safe }}
                </div>
            </div>
        </div>

<!-- Навигация между версиями -->
{% if adjacent_versions.prev or adjacent_versions.next %}
<div class="card mt-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                {% if adjacent_versions.prev %}
                <a href="{% url 'docs:version_detail' article.slug adjacent_versions.prev.id %}"
                   class="btn btn-outline-primary w-100 text-start">
                    <i class="bi bi-arrow-left"></i>
                    Предыдущая версия (v{{ adjacent_versions.prev.version_number }})
                    <br>
                    <small class="text-muted">{{ adjacent_versions.prev.created_at|date:"d.m.Y H:i" }}</small>
                </a>
                {% endif %}
            </div>
            <div class="col-md-6">
                {% if adjacent_versions.next %}
                <a href="{% url 'docs:version_detail' article.slug adjacent_versions.next.id %}"
                   class="btn btn-outline-primary w-100 text-end">
                    Следующая версия (v{{ adjacent_versions.next.version_number }})
                    <i class="bi bi-arrow-right"></i>
                    <br>
                    <small class="text-muted">{{ adjacent_versions.next.created_at|date:"d.m.Y H:i" }}</small>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
    </div>
</div>
{% endblock %}