{% extends 'docs/base.html' %}
{% load static %}

{% block title %}
    {% if form.instance.pk %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é{% else %}–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤–∏–¥–µ–Ω */
    .editormd {
        z-index: 1000 !important;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª—è —Ç–µ–≥–æ–≤ */
    select[multiple] {
        height: auto;
        min-height: 120px;
    }
    .form-text {
        font-size: 0.875rem;
        color: #6c757d;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        {% if form.instance.pk %}
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é
                        {% else %}
                            üìù –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é
                        {% endif %}
                    </h4>
                </div>
                <div class="card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}

                        <div class="mb-3">
                            <label class="form-label">{{ form.title.label }}</label>
                            {{ form.title }}
                            {% if form.title.help_text %}
                                <div class="form-text">{{ form.title.help_text }}</div>
                            {% endif %}
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">{{ form.category.label }}</label>
                                {{ form.category }}
                                {% if form.category.help_text %}
                                    <div class="form-text">{{ form.category.help_text }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.status.label }}</label>
                                {{ form.status }}
                                {% if form.status.help_text %}
                                    <div class="form-text">{{ form.status.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- –î–û–ë–ê–í–õ–Ø–ï–ú –ë–õ–û–ö –¢–ï–ì–û–í -->
                        <div class="mb-3">
                            <label class="form-label">
                                <i class="bi bi-tags"></i> {{ form.tags.label }}
                            </label>
                            {{ form.tags }}
                            <div class="form-text">
                                üî∏ –£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl (–∏–ª–∏ Cmd –Ω–∞ Mac) –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ–≥–æ–≤
                            </div>
                            {% if form.tags.help_text %}
                                <div class="form-text">{{ form.tags.help_text }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <label class="form-label">{{ form.excerpt.label }}</label>
                            {{ form.excerpt }}
                            {% if form.excerpt.help_text %}
                                <div class="form-text">{{ form.excerpt.help_text }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-4">
                            <label class="form-label">{{ form.content.label }}</label>
                            {% if form.content.help_text %}
                                <div class="form-text mb-2">{{ form.content.help_text }}</div>
                            {% endif %}
                            <div id="mdeditor-container">
                                {{ form.content }}
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{% if form.instance.pk %}{% url 'docs:article_detail' form.instance.slug %}{% else %}{% url 'docs:article_list' %}{% endif %}"
                               class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
                            <button type="submit" class="btn btn-primary">
                                {% if form.instance.pk %}üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å{% else %}üìÑ –°–æ–∑–¥–∞—Ç—å{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–≥–∞—Ö -->
            <div class="mt-3">
                <div class="alert alert-info">
                    <h6 class="alert-heading"><i class="bi bi-lightbulb"></i> –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ç–µ–≥–æ–≤:</h6>
                    <ul class="mb-0">
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥–∏ –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞ —Å—Ç–∞—Ç–µ–π</li>
                        <li>–í—ã–±–∏—Ä–∞–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Å—ã–≤–∞—é—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</li>
                        <li>–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–µ–≥–æ–≤ - 3-5 –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ</li>
                        <li>–¢–µ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- –ú–ï–î–ò–ê-–§–ê–ô–õ–´ MDEditor -->
{{ form.media }}

<script>
// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
$(document).ready(function() {
    console.log('jQuery loaded:', typeof $ !== 'undefined');
    console.log('editormd loaded:', typeof editormd !== 'undefined');

    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    setTimeout(function() {
        if (typeof editormd !== 'undefined') {
            console.log('MDEditor is available');
        }
    }, 1000);

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤
    $('select[name="tags"]').on('change', function() {
        const selectedCount = $(this).find('option:selected').length;
        console.log('Selected tags:', selectedCount);
    });
});
</script>
{% endblock %}