{% extends 'docs/base.html' %}
{% load static %}

{% block title %}
    {% if form.instance.pk %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é{% else %}–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤–∏–¥–µ–Ω */
    .editormd {
        z-index: 1000 !important;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª—è —Ç–µ–≥–æ–≤ */
    select[multiple] {
        height: auto;
        min-height: 120px;
    }
    .form-text {
        font-size: 0.875rem;
        color: #6c757d;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        {% if form.instance.pk %}
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é
                        {% else %}
                            üìù –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é
                        {% endif %}
                    </h4>
                </div>
                <div class="card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}

                        <div class="mb-3">
                            <label class="form-label">{{ form.title.label }}</label>
                            {{ form.title }}
                            {% if form.title.help_text %}
                                <div class="form-text">{{ form.title.help_text }}</div>
                            {% endif %}
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">{{ form.category.label }}</label>
                                {{ form.category }}
                                {% if form.category.help_text %}
                                    <div class="form-text">{{ form.category.help_text }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.status.label }}</label>
                                {{ form.status }}
                                {% if form.status.help_text %}
                                    <div class="form-text">{{ form.status.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>

<!-- –¢–µ–≥–∏ -->
<div class="mb-3">
    <label class="form-label">
        <i class="bi bi-tags"></i> {{ form.tags.label }}
    </label>
    {{ form.tags }}
    <div class="form-text">
        üî∏ –£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl (–∏–ª–∏ Cmd –Ω–∞ Mac) –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ–≥–æ–≤
    </div>
    {% if form.tags.help_text %}
        <div class="form-text">{{ form.tags.help_text }}</div>
    {% endif %}
</div>

            <!-- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ–≥–æ–≤ -->
            <div class="mb-3">
                <label class="form-label">
                    <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–µ–≥–∏
                </label>
                {{ form.new_tags }}
                <div class="form-text">
                    üî∏ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–µ —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: "python, django, –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞")
                </div>
                {% if form.new_tags.help_text %}
                    <div class="form-text">{{ form.new_tags.help_text }}</div>
                {% endif %}
                {% if form.new_tags.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.new_tags.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤ -->
            <div class="mb-3">
                <label class="form-label">
                    <i class="bi bi-check2-circle"></i> –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏:
                </label>
                <div id="tags-container" class="d-flex flex-wrap p-3 border rounded bg-light min-h-50" style="min-height: 50px;">
                    <span class="text-muted">–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏...</span>
                </div>
                <div class="form-text">
                    üî∏ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫ ‚úï —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —Ç–µ–≥
                </div>
            </div>

                        <div class="mb-3">
                            <label class="form-label">{{ form.excerpt.label }}</label>
                            {{ form.excerpt }}
                            {% if form.excerpt.help_text %}
                                <div class="form-text">{{ form.excerpt.help_text }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-4">
                            <label class="form-label">{{ form.content.label }}</label>
                            {% if form.content.help_text %}
                                <div class="form-text mb-2">{{ form.content.help_text }}</div>
                            {% endif %}
                            <div id="mdeditor-container">
                                {{ form.content }}
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{% if form.instance.pk %}{% url 'docs:article_detail' form.instance.slug %}{% else %}{% url 'docs:article_list' %}{% endif %}"
                               class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
                            <button type="submit" class="btn btn-primary">
                                {% if form.instance.pk %}üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å{% else %}üìÑ –°–æ–∑–¥–∞—Ç—å{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–≥–∞—Ö -->
            <div class="mt-3">
                <div class="alert alert-info">
                    <h6 class="alert-heading"><i class="bi bi-lightbulb"></i> –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ç–µ–≥–æ–≤:</h6>
                    <ul class="mb-0">
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥–∏ –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞ —Å—Ç–∞—Ç–µ–π</li>
                        <li>–í—ã–±–∏—Ä–∞–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Å—ã–≤–∞—é—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</li>
                        <li>–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–µ–≥–æ–≤ - 3-5 –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ</li>
                        <li>–¢–µ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- –ú–ï–î–ò–ê-–§–ê–ô–õ–´ MDEditor -->
{{ form.media }}

<script>
// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
$(document).ready(function() {
    console.log('jQuery loaded:', typeof $ !== 'undefined');
    console.log('editormd loaded:', typeof editormd !== 'undefined');

    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    setTimeout(function() {
        if (typeof editormd !== 'undefined') {
            console.log('MDEditor is available');
        }
    }, 1000);

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤
    $('select[name="tags"]').on('change', function() {
        const selectedCount = $(this).find('option:selected').length;
        console.log('Selected tags:', selectedCount);
    });
});


</script>
<script>
// –ü—Ä–æ—Å—Ç–æ–π JavaScript –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const tagsSelect = document.getElementById('tags-select');
    const newTagsInput = document.getElementById('new-tags-input');
    const tagsContainer = document.getElementById('tags-container');

    function updateTagsDisplay() {
        if (!tagsContainer) return;

        let html = '';

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ–≥–∏
        if (tagsSelect) {
            Array.from(tagsSelect.selectedOptions).forEach(option => {
                html += `<span class="badge bg-primary me-2 mb-2">${option.text} ‚úï</span>`;
            });
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ —Ç–µ–≥–∏
        if (newTagsInput && newTagsInput.value.trim()) {
            const newTags = newTagsInput.value.split(',').map(tag => tag.trim()).filter(tag => tag);
            newTags.forEach(tag => {
                html += `<span class="badge bg-success me-2 mb-2">${tag} (–Ω–æ–≤—ã–π) ‚úï</span>`;
            });
        }

        tagsContainer.innerHTML = html || '<span class="text-muted">–¢–µ–≥–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã...</span>';

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        tagsContainer.querySelectorAll('.badge').forEach(badge => {
            badge.style.cursor = 'pointer';
            badge.addEventListener('click', function() {
                // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - –æ—á–∏—â–∞–µ–º –ø–æ–ª–µ –Ω–æ–≤—ã—Ö —Ç–µ–≥–æ–≤
                if (newTagsInput) newTagsInput.value = '';
                updateTagsDisplay();
            });
        });
    }

    if (tagsSelect) tagsSelect.addEventListener('change', updateTagsDisplay);
    if (newTagsInput) newTagsInput.addEventListener('input', updateTagsDisplay);

    updateTagsDisplay();
});
</script>


{% endblock %}