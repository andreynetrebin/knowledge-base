Changelog - База знаний

## [1.6.1] - 2025-10-15

### Исправлено

- **Критическая ошибка "Cannot combine a unique query with a non-unique query"** в ArticleDetailView
- Проблемы с комбинированием запросов в методах получения похожих статей
- Ошибки в цепочках запросов к базе данных с оператором OR (|)
- Конфликты между unique и non-unique запросами в Django ORM

### Исправлено

- **Проблемы с созданием статей и обработкой форм**
- Ошибка "BaseForm.__init__() got an unexpected keyword argument 'instance'"
- Конфликты между ModelForm и обычными Form в системе версионности
- Некорректная работа методов get_queryset() в представлениях

### Улучшено

- **Стабильность системы версионности**
- Оптимизированы запросы к базе данных в ArticleDetailView
- Улучшена обработка ошибок в цепочках связанных объектов
- Добавлена обработка исключений в критических методах моделей

### Улучшено

- **Функционал управления тегами**
- Добавлена возможность создания новых тегов при создании статьи
- Валидация новых тегов на длину и формат
- Визуальное отображение выбранных тегов в форме
- Интеграция создания тегов в существующий интерфейс

### Технические детали

- Замена проблемных комбинированных запросов на отдельные фильтры
- Использование union() вместо оператора | для объединения queryset
- Упрощение сложных цепочек запросов к базе данных
- Добавление обработки исключений в методы подсчета лайков/комментариев

### Оптимизация

- Улучшена производительность страницы статьи
- Оптимизированы запросы для похожих статей
- Уменьшена нагрузка на базу данных в сложных сценариях
- Улучшена обработка edge cases в системе версионности

## [1.6.0] - 2025-10-14

### Добавлено

- **Система экспорта статей в различные форматы**
- Экспорт в HTML с полным форматированием и стилями
- Экспорт в PDF с поддержкой русских шрифтов и разметкой
- Экспорт в простой текст (TXT) для быстрого копирования
- Страница выбора форматов экспорта с визуальными карточками
- История экспортов для отслеживания предыдущих выгрузок

### Добавлено

- **Модель ArticleExport для отслеживания операций экспорта**
- Запись формата, пользователя, даты и размера файла
- Связь с статьями и пользователями для аналитики
- Автоматическое создание записей при каждом экспорте

### Добавлено

- **Утилиты экспорта на основе класса ArticleExporter**
- Поддержка конвертации Markdown в HTML для экспорта
- Генерация PDF через WeasyPrint с корректной кодировкой
- Создание текстовых версий с сохранением структуры
- Обработка ошибок и пользовательские сообщения

### Добавлено

- **Профессиональные шаблоны для каждого формата экспорта**
- Адаптивный HTML-шаблон с полной стилизацией
- PDF-шаблон с постраничной разметкой и колонтитулами
- Текстовый шаблон с чистой структурой и метаданными
- Страница выбора форматов с интуитивным интерфейсом

### Технические детали

- Интеграция WeasyPrint для генерации PDF
- Поддержка русской кодировки во всех форматах
- Автоматическое именование файлов с временными метками
- Обработка временных файлов для PDF генерации
- Валидация наличия текущей версии перед экспортом

### Безопасность

- Ограничение экспорта только для авторизованных пользователей
- Проверка прав доступа к статьям
- Защита от экспорта статей без содержимого

## [1.5.1] - 2025-10-13

### Добавлено

- **Полный набор шаблонов для системы версионности**
- Страница истории версий с пагинацией и статистикой
- Детальный просмотр конкретной версии статьи
- Сравнение двух версий с визуальным diff
- Подтверждение восстановления версий с предварительным просмотром
- Навигация между версиями (предыдущая/следующая)

### Добавлено

- **Интеграция версионности в интерфейс статьи**
- Блок истории изменений в сайдбаре
- Информация о текущей версии в метаданных статьи
- Ссылки на управление версиями для авторов
- Визуальные индикаторы текущей версии и черновиков

### Исправлено

- Ошибка "FieldError: Cannot resolve keyword 'slug'" в представлениях версий
- Проблемы с навигацией между версиями
- Конфликты URL-параметров в маршрутизации
- Ошибки шаблонов при отсутствии текущей версии

### Улучшено

- Безопасность: проверка принадлежности версии к статье
- Пользовательский опыт: интуитивная навигация по истории версий
- Производительность: оптимизированные запросы к базе данных
- Адаптивность: мобильная версия всех шаблонов версионности

### Технические детали

- Кастомные методы get_adjacent_versions для навигации
- Фильтрация версий по принадлежности к статье
- Обработка Markdown в шаблонах версий
- Стилизация diff-сравнения версий
- Модальные подтверждения для критических действий

## [1.5.0] - 2025-10-12

### Добавлено

- **Система версионности статей** - полная история изменений с возможностью восстановления
- Модель ArticleVersion для хранения всех версий статьи
- Автоматическая нумерация версий при создании
- История версий с просмотром, сравнением и восстановлением
- Механизм создания новых версий при редактировании статей
- Отслеживание причин изменений для каждой версии
- Поддержка черновиков версий

### Технические детали

- Модель Article теперь содержит только метаданные
- ArticleVersion хранит контент, заголовок и описание для каждой версии
- Связь ForeignKey между Article и ArticleVersion
- Автоматическое определение номера версии при сохранении
- Миграции для перехода на версионную систему

## [1.4.0] - 2025-09-30

### Добавлено

- **Система комментариев** с древовидной структурой (MPTT)
- Вложенные комментарии с неограниченной глубиной
- Форма добавления комментариев к статьям
- Редактирование и удаление собственных комментариев
- Модерация комментариев (одобрение/скрытие)
- Подсчет количества комментариев к статьям
- Визуальное отображение иерархии комментариев

### Добавлено

- **Система оценок (лайки/дизлайки)** для статей
- Уникальная оценка от каждого пользователя
- Валидация против самооценки собственных статей
- Визуальное отображение счетчиков лайков/дизлайков
- Интерактивные кнопки оценок с AJAX-обновлением

### Добавлено

- **Система избранных статей**
- Добавление/удаление статей в избранное
- Отслеживание избранного для каждого пользователя
- Визуальная индикация статуса избранного

### Технические детали

- Модель Comment с MPTT-структурой для древовидных комментариев
- Модель Rating для хранения оценок с уникальным ограничением
- Модель Favorite для избранных статей
- AJAX-обработка действий (оценки, избранное)
- Оптимизированные запросы с индексами

## [1.3.0] - 2025-09-30

### Добавлено

- Система тегов для статей с ManyToMany связью
- Облако тегов с визуализацией популярности
- Поиск и фильтрация статей по тегам
- Страница всех тегов (/tags/)
- Страница статей по конкретному тегу (/tag/slug/)
- Интеграция тегов в интерфейс (боковые панели, карточки статей)
- Поддержка множественного выбора тегов при создании/редактировании статей

### Исправлено

- Конфликты имен URL patterns
- Проблемы с отображением навигации
- Интеграция тегов в существующие шаблоны

### Технические детали

- Модель Tag с полями name, slug, description
- Интеграция тегов в формы создания/редактирования статей
- Представления для облака тегов и фильтрации по тегам
- Обновление поиска для поддержки поиска по тегам
- Оптимизация запросов с prefetch_related для тегов

## [1.2.0] - 2025-09-28

### Добавлено

- MDEditor с панелью инструментов для редактирования статей
- Русская локализация редактора (перевод с китайского)
- Загрузка изображений через редактор

### Исправлено

- Конфликты slug в админке Django
- Ошибки TemplateDoesNotExist
- Проблемы с отображением панели Markdown
- Ошибки X-Frame-Options для загрузки файлов
- Конфликты jQuery и Bootstrap

## [1.1.0] - 2025-09-15

### Добавлено

- Функционал выхода из системы (logout) с подтверждением
- Обработка GET и POST запросов для выхода
- Страница подтверждения выхода
- Безопасная обработка форм выхода

### Исправлено

- Ошибка "Method Not Allowed (GET): /accounts/logout/"
- Навигация для корректного выхода из системы

## [1.0.0] - 2025-09-14

### Добавлено

- Инициализация Django проекта
- Многопользовательская система аутентификации
- Система статей с Markdown-редактором
- Древовидные категории статей
- Поиск по статьям
- Адаптивный интерфейс на Bootstrap 5
- Система регистрации новых пользователей
- Форма регистрации с валидацией
- Автоматический вход после регистрации
- Проверка уникальности email и username
